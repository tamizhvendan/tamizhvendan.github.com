---
layout: post
title: "Unit Testing Custom Model Binders in MVC3"
date: 2012-02-11
comments: true
categories:
 - Unit Testing
 - ASP.NET MVC
---

<div class='post'>
    <p>
        In <a href="{% post_url 2012-02-02-unit-testing-with-sessions-in-aspnet %}">my previous post</a> we have seen a way to do unit testing 
        with Sessions in MVC3 using Custom model binders. In this blog post we are going to see how to do unit test the model binder itself.
    </p>
    <p>
        One remarkable thing which everybody hails in MVC3 is its extensibility and its testability. You can extend/customize the components in the 
        framework and also you can unit test them with ease.
    </p>
    <p>
        Before getting into unit testing the custom model binder, Lets have a closer look at 
            the <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.imodelbinder.bindmodel.aspx">BindModel</a> method
    </p>
    <br />
    {% img center /images/UnitTesting_ModelBinders/BindModel.png %}
       
        <p>
            In the BindModel method we are making use of Session property in the HttpContext object which is in turn a property of 
            the <a href="http://msdn.microsoft.com/en-us/library/dd492673.aspx">ControllerContext</a> object that is passed to the BindModel method as 
            a parameter by the MVC3 framework. In order to unit test this method we need to have to control over the HttpContext property of 
            the ControllerContext and the Session property of the HttpContext.
    </p>

    <p>How to get control over those properties ? Thanks to <a href="http://msdn.microsoft.com/en-us/library/dd460098.aspx">a constructor of ControllerContext</a></p>
    <br />{% img center /images/UnitTesting_ModelBinders/ControllerContext.png %}        
        <p>ControllerContext uses the constructor dependency injection to get rid of the direct dependency on <a href="http://msdn.microsoft.com/en-us/library/system.web.httpcontextbase.aspx">HttpContextBase</a> and we are going to exploit this to do unit testing. Using a mocking framework we can easily create a mock of HttpContetBase and drive the unit test.</p>
    <p>The Session property of the HttpContextBase is of type <a href="http://msdn.microsoft.com/en-us/library/system.web.httpsessionstatebase.aspx">HttpSessionStateBase</a> which can also be mocked.</p>
    <p>Here is the complete implementation of Test fixture class which unit test the CartModelBinder class that we have seen in the <a href="{% post_url 2012-02-02-unit-testing-with-sessions-in-aspnet %}">previous post</a> using the mocking library <a href="http://code.google.com/p/moq/">Moq</a>.</p>
    <br />{% img center /images/UnitTesting_ModelBinders/UnitTest.png %}      

</div>
