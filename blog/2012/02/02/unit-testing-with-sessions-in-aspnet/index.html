
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Unit Testing with Sessions in ASP.NET MVC3 - P3 Programmer</title>
	<meta name="author" content="Tamizhvendan S">

	
	<meta name="description" content="Unit Testing With Sessions in ASP.NET MVC3 Introduction While talking to my friend regarding his project, he told me about how he is doing unit &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="http://feeds.feedburner.com/tamizhvendan-blog" rel="alternate" title="P3 Programmer" type="application/atom+xml">
	
	<link rel="canonical" href="http://blog.tamizhvendan.in/blog/2012/02/02/unit-testing-with-sessions-in-aspnet/">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link href="/favicon.png" rel="shortcut icon">
  <link href='/stylesheets/fonts.css' rel='stylesheet' type='text/css'>
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">	
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
  <style type="text/css">
  p, li, #tag-cloud {
    font-family: "Archer A","Archer B","georgia","serif";
    line-height: 1.4em;
    font-size: 1.354rem;
    font-weight: 500;
    color: #222222;
    margin: 0;
    font-style: normal;
  }  
  h1, h2, h3 {
    font-family: 'Archer A','Archer B',georgia,serif;
    font-weight: 800 !important;
    font-style: normal;
    font-size: 2.6154rem !important;
    padding: 1.6154rem 0;
    color: #286c8d;
  }
  h1 {
    font-size: 2.6154rem !important;    
  }
  h2 {
    font-size: 1.8rem !important;
  }
  h3 {
    font-size: 1.6154rem !important;
  }
  h4 {
    font-size: 1.5rem !important;
  }
  div.mid-col {
    background-color: #f8f8f8;
  }
  pre code {
    font-family: Consolas,Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
    font-size: 1em;
    line-height: 1.8;
    display: block;
    background: #fff;
    color: #000;
    border: solid 1px #eee;
    box-shadow: 1px 1px 2px #aaa;
    margin: 10px 0 8px 0;
    overflow-x: auto;
    word-wrap: break-word;
  }
  td.gutter {
    display: none;
  }
  td.code {
    padding-left: 0px;
  }
  a:hover {
    color: #428bca !important;    
  }
  </style>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-43004255-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("tamizh88@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="http://about.me/tamizhvendan">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
    <li><a href="/open-source-contributions">Contributions</a></li>
</ul>
<a href="http://www.codeproject.com" rel="tag" style="display:none">CodeProject</a>
</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:tamizh88@gmail.com" title="Email">Email</a>
		
		
		
		
			<a class="twitter" href="http://twitter.com/tamizhvendan" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/tamizhvendan" title="GitHub">GitHub</a>
		
		
			<a class="coderwall" href="https://coderwall.com/tamizhvendan" title="Coderwall">Coderwall</a>
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="http://feeds.feedburner.com/tamizhvendan-blog" title="RSS">RSS</a>
		
	</div>
<nav id="tag-cloud">
	<section>
    <span id="tag-cloud"><a href='/blog/categories/asp-dot-net' style='font-size: 103.52941176470588%'>asp.net</a> <a href='/blog/categories/asp-dot-net-mvc' style='font-size: 156.47058823529412%'>asp.net mvc</a> <a href='/blog/categories/asp-dot-net-identity' style='font-size: 103.52941176470588%'>asp.net-identity</a> <a href='/blog/categories/c-number' style='font-size: 114.11764705882354%'>c#</a> <a href='/blog/categories/craftsmanship' style='font-size: 114.11764705882354%'>craftsmanship</a> <a href='/blog/categories/data-access' style='font-size: 110.58823529411765%'>data access</a> <a href='/blog/categories/devops' style='font-size: 103.52941176470588%'>devops</a> <a href='/blog/categories/dsl' style='font-size: 103.52941176470588%'>dsl</a> <a href='/blog/categories/entity-framework' style='font-size: 117.64705882352942%'>entity framework</a> <a href='/blog/categories/fake' style='font-size: 103.52941176470588%'>fake</a> <a href='/blog/categories/fparsec' style='font-size: 103.52941176470588%'>fparsec</a> <a href='/blog/categories/fsharp' style='font-size: 160.0%'>fsharp</a> <a href='/blog/categories/functional-programming' style='font-size: 124.70588235294117%'>functional-programming</a> <a href='/blog/categories/goals' style='font-size: 103.52941176470588%'>goals</a> <a href='/blog/categories/javascript' style='font-size: 110.58823529411765%'>javascript</a> <a href='/blog/categories/jquery' style='font-size: 107.05882352941177%'>jquery</a> <a href='/blog/categories/node-dot-js' style='font-size: 107.05882352941177%'>node.js</a> <a href='/blog/categories/others' style='font-size: 103.52941176470588%'>others</a> <a href='/blog/categories/owin' style='font-size: 103.52941176470588%'>owin</a> <a href='/blog/categories/programming' style='font-size: 121.17647058823529%'>programming</a> <a href='/blog/categories/rop' style='font-size: 103.52941176470588%'>rop</a> <a href='/blog/categories/rx' style='font-size: 103.52941176470588%'>rx</a> <a href='/blog/categories/signalr' style='font-size: 103.52941176470588%'>signalr</a> <a href='/blog/categories/suave' style='font-size: 103.52941176470588%'>suave</a> <a href='/blog/categories/unit-testing' style='font-size: 117.64705882352942%'>unit testing</a> <a href='/blog/categories/web-api' style='font-size: 110.58823529411765%'>web-api</a> </span>
</section>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Unit Testing With Sessions in ASP.NET MVC3</h1>
	<div class="entry-content" itemprop="articleBody"><div class='post'>
    <h3>Introduction</h3>
        
        <p>While talking to my friend regarding his project, he told me about how he is doing unit testing which involves sessions in ASP.NET MVC3. 
            His team is actually using a “HttpSimulator” which simulates the web request and then the do unit test by verifying the session by interacting 
            with the simulator. When digging further I have come to know that this way of unit testing session objects are influenced 
            from the “ASP.NET Webforms”. It reminds me the talk of <a href="http://www.infoq.com/presentations/Functional-Thinking">Neil Ford on 
                Function Thinking</a>. In that video he talks about an analogy called “Axe and Chain Saw” to explain our way of thinking as
        </p>
        <blockquote>When we give a chain saw to people who were cutting trees by axe, they would tend to use chain saw in the same way as the use Axe. 
            Which is obviously inefficient. So we should understand at the capabilities of the tool in our hand before we using it</blockquote>
       
        <p>ASP.NET MVC3 is far better than Web Forms when it comes to unit testing. We don’t need to use a simulator to test against our sessions. 
            There is a better way to do this MVC3 and in this blog post we are going to explore it.<p/>
       
        <h4>Time for Code</h4>       
        <p>Shopping Cart is the first thing that strikes our mind when we want to quote an example for using Http session. 
        So, I am going to show an app called “MyShop” a mini shopping site through which I am going to explain the concepts involved. 
        The application flow would be as follows</p>
        
            <img class="center" src="/images/UnitTesting_With_Session/Cart.png">
            <img class="center" src="/images/UnitTesting_With_Session/Cart2.png">       
        

        <h4>Models</h4>
        
        <p>The models are simple, straight forward and self explanatory.</p>
    <img class="center" src="/images/UnitTesting_With_Session/model.png">  
    <img class="center" src="/images/UnitTesting_With_Session/CartCsharp.png">    
        <p>I’ve tried my level best to keep the model as simple as possible. 
        So, Cart in MyShop will have only two public methods. One to add a product to the Cart’s Line and another one to retrieve all the 
        products inside the Cart’s line.</p>
        
        <h4>The CartController Version 1.0</h4>
        <img class="center" src="/images/UnitTesting_With_Session/CartController.png"> 
        <p>In this CartController version 1.0 we have two public methods Index and AddToCart which are dependent on HttpSession object. 
            This dependency inside the methods is actually preventing us from unit testing the CartController in simple way and we have no 
            choice other than implementing a “Http Simulator” to unit test these two methods. As I said before there is better to do is! Here we go!!</p>
        
        <h4>The CartController Version 2.0</h4>
        <img class="center" src="/images/UnitTesting_With_Session/CartController2.png"> 
    <p>No more Sessions!!.. Yeah.. We have got rid of the dependency on the session object by adding a new parameter called cart. Now you can use easily unit test the CartController as follows</p>
        <img class="center" src="/images/UnitTesting_With_Session/UnitTest.png"> 
        <p>Okay we made it easy for unit testing by moving the dependency out of the method and introduced the cart as the parameter. But how does my MVC3 framework will know the cart parameter should come from session object ?… Good Catch!! and here comes the magic called custom ModelBinder</p>
       
        <h4>ModelBinder – A brief background</h4>
        <p>Model binding is an exciting feature in MVC3 framework which automatically creates the C# objects directly from Http request and 
            pass it to the Action methods in controller as parameter values. It uses a default model binder which looks at the form values, 
            query string values that are submitted with the Http Request and create the model object.</p>
        <h4>CartModelBinder</h4>
        
        <p>In our case, we need to have a object of Cart which is populated from the Session object and not from the HttpRequest. 
            The default model binder used by MVC3 has no idea about session object. So, Its our responsibility to tell to the MVC3 framework
        </p>
        
        <p>“<em>Hey! If there is any parameter of type Cart in controller action method, then use my own custom model binder called CartModelBinder to create the object</em>”</p>
        <p>There are two steps to do the above said operation</p>
        <p>1. Creating the custom model binder by inheriting the IModelBinder interface</p>
        <img class="center" src="/images/UnitTesting_With_Session/CartModelBinder.png"> 
        <p>2. Registering our custom model binder in the Global.asax.cs file</p>
        <img class="center" src="/images/UnitTesting_With_Session/AppStart.png"> 
        <p>
        That’s all.. MVC3 takes care of rest</p>
        
        <h4>Summary</h4>
        <p>In this blog post we have explored how we can get rid of “Http Simulator” to unit test the controllers which involves Session objects using 
            custom model binder. You can download the working example of “MyShop” showcased in this blog post 
            from <a href="http://www.box.com/s/b9lf2heukyivh68921jj">here</a>. 
            Refer <a href="/blog/2012/02/11/unit-testing-custom-model-binders-in/">my next blog post</a> to check out how to do 
            unit testing with the custom model binder itself.</p>
</div>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    Tamizhvendan S


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'tamizhvendan-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.tamizhvendan.in/blog/2012/02/02/unit-testing-with-sessions-in-aspnet/';
        var disqus_url = 'http://blog.tamizhvendan.in/blog/2012/02/02/unit-testing-with-sessions-in-aspnet/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>






</body>
</html>
